<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An implementation of the Olm double ratchet."><title>vodozemac::olm - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="vodozemac" data-themes="" data-resource-suffix="" data-rustdoc-version="1.92.0-nightly (6501e64fc 2025-10-23)" data-channel="nightly" data-search-js="search-d69d8955.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module olm</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../vodozemac/index.html">vodozemac</a><span class="version">0.9.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module olm</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#sending-messages" title="Sending messages">Sending messages</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate vodozemac</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">vodozemac</a></div><h1>Module <span>olm</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/vodozemac/olm/mod.rs.html#16-114">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An implementation of the Olm double ratchet.</p>
<h3 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h3>
<p>The core component of the crate is the <a href="struct.Account.html" title="struct vodozemac::olm::Account"><code>Account</code></a>, representing a single
Olm participant. An Olm <a href="struct.Account.html" title="struct vodozemac::olm::Account"><code>Account</code></a> consists of a collection of key pairs,
though often documentation will shorten this to just “keys”. These are:</p>
<ol>
<li>An Ed25519 <em>signing key pair</em> representing the stable cryptographic
identity of the participant (the participant’s “fingerprint”).</li>
<li>A Curve25519 <em>sender key pair</em> (also sometimes called the <em>identity key
pair</em>, somewhat confusingly).</li>
<li>A number of one-time key pairs.</li>
<li>A current and previous (if any) “fallback” key pair.</li>
</ol>
<p>While the key in 1 is used for signing but not encryption, the keys in 2-4
participate in a triple Diffie-Hellman key exchange (3DH) with another Olm
participant, thereby establishing an Olm session on each side of the
communication channel. Ultimately, this session is used for deriving the
concrete encryption keys for a particular message.</p>
<p>Olm sessions are represented by the <a href="struct.Session.html" title="struct vodozemac::olm::Session"><code>Session</code></a> struct. Such a session is
created by calling <a href="struct.Account.html#method.create_outbound_session" title="method vodozemac::olm::Account::create_outbound_session"><code>Account::create_outbound_session</code></a> on one of the
participating accounts, passing it the Curve25519 sender key and one
Curve25519 one-time key of the other side. The protocol is asynchronous, so
the participant can start sending messages to the other side even before the
other side has created a session, producing so-called pre-key messages (see
<a href="struct.PreKeyMessage.html" title="struct vodozemac::olm::PreKeyMessage"><code>PreKeyMessage</code></a>).</p>
<p>Once the other participant receives such a pre-key message, they can create
their own matching session by calling <a href="struct.Account.html#method.create_inbound_session" title="method vodozemac::olm::Account::create_inbound_session"><code>Account::create_inbound_session</code></a>
and passing it the pre-key message they received and the Curve25519 sender
key of the other side. This completes the establishment of the Olm
communication channel.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>anyhow::Result;
<span class="kw">use </span>vodozemac::olm::{Account, InboundCreationResult, OlmMessage, SessionConfig};

<span class="kw">fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;()&gt; {
    <span class="kw">let </span>alice = Account::new();
    <span class="kw">let </span><span class="kw-2">mut </span>bob = Account::new();

    bob.generate_one_time_keys(<span class="number">1</span>);
    <span class="kw">let </span>bob_otk = <span class="kw-2">*</span>bob.one_time_keys().values().next().unwrap();

    <span class="kw">let </span><span class="kw-2">mut </span>alice_session = alice
        .create_outbound_session(SessionConfig::version_2(), bob.curve25519_key(), bob_otk);

    bob.mark_keys_as_published();

    <span class="kw">let </span>message = <span class="string">"Keep it between us, OK?"</span>;
    <span class="kw">let </span>alice_msg = alice_session.encrypt(message);

    <span class="kw">if let </span>OlmMessage::PreKey(m) = alice_msg.clone() {
        <span class="kw">let </span>result = bob.create_inbound_session(alice.curve25519_key(), <span class="kw-2">&amp;</span>m)<span class="question-mark">?</span>;

        <span class="kw">let </span><span class="kw-2">mut </span>bob_session = result.session;
        <span class="kw">let </span>what_bob_received = result.plaintext;

        <span class="macro">assert_eq!</span>(alice_session.session_id(), bob_session.session_id());

        <span class="macro">assert_eq!</span>(message.as_bytes(), what_bob_received);

        <span class="kw">let </span>bob_reply = <span class="string">"Yes. Take this, it's dangerous out there!"</span>;
        <span class="kw">let </span>bob_encrypted_reply = bob_session.encrypt(bob_reply).into();

        <span class="kw">let </span>what_alice_received = alice_session
            .decrypt(<span class="kw-2">&amp;</span>bob_encrypted_reply)<span class="question-mark">?</span>;
        <span class="macro">assert_eq!</span>(what_alice_received, bob_reply.as_bytes());
    }

    <span class="prelude-val">Ok</span>(())
}</code></pre></div><h3 id="sending-messages"><a class="doc-anchor" href="#sending-messages">§</a>Sending messages</h3>
<p>To encrypt a message, just call <a href="struct.Session.html#method.encrypt" title="method vodozemac::olm::Session::encrypt"><code>Session::encrypt()</code></a>. This will
either produce an <a href="enum.OlmMessage.html#variant.PreKey" title="variant vodozemac::olm::OlmMessage::PreKey"><code>OlmMessage::PreKey</code></a> or <a href="enum.OlmMessage.html#variant.Normal" title="variant vodozemac::olm::OlmMessage::Normal"><code>OlmMessage::Normal</code></a>
depending on whether the session is fully established. A session is fully
established once you receive (and decrypt) at least one message from the
other side.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.Account.html" title="struct vodozemac::olm::Account">Account</a></dt><dd>An Olm <a href="struct.Account.html" title="struct vodozemac::olm::Account"><code>Account</code></a> manages all cryptographic keys used on a device.</dd><dt><a class="struct" href="struct.AccountPickle.html" title="struct vodozemac::olm::AccountPickle">Account<wbr>Pickle</a></dt><dd>A format suitable for serialization which implements <a href="https://docs.rs/serde_core/1.0.228/serde_core/ser/trait.Serialize.html" title="trait serde_core::ser::Serialize"><code>serde::Serialize</code></a>
and <a href="https://docs.rs/serde_core/1.0.228/serde_core/de/trait.Deserialize.html" title="trait serde_core::de::Deserialize"><code>serde::Deserialize</code></a>. Obtainable by calling <a href="struct.Account.html#method.pickle" title="method vodozemac::olm::Account::pickle"><code>Account::pickle</code></a>.</dd><dt><a class="struct" href="struct.IdentityKeys.html" title="struct vodozemac::olm::IdentityKeys">Identity<wbr>Keys</a></dt><dd>Struct holding the two public identity keys of an <a href="struct.Account.html" title="struct vodozemac::olm::Account"><code>Account</code></a>.</dd><dt><a class="struct" href="struct.InboundCreationResult.html" title="struct vodozemac::olm::InboundCreationResult">Inbound<wbr>Creation<wbr>Result</a></dt><dd>Return type for the creation of inbound <a href="struct.Session.html" title="struct vodozemac::olm::Session"><code>Session</code></a> objects.</dd><dt><a class="struct" href="struct.Message.html" title="struct vodozemac::olm::Message">Message</a></dt><dd>An encrypted Olm message.</dd><dt><a class="struct" href="struct.OneTimeKeyGenerationResult.html" title="struct vodozemac::olm::OneTimeKeyGenerationResult">OneTime<wbr>KeyGeneration<wbr>Result</a></dt><dd>The result type for the one-time key generation operation.</dd><dt><a class="struct" href="struct.PreKeyMessage.html" title="struct vodozemac::olm::PreKeyMessage">PreKey<wbr>Message</a></dt><dd>An encrypted Olm pre-key message.</dd><dt><a class="struct" href="struct.RatchetPublicKey.html" title="struct vodozemac::olm::RatchetPublicKey">Ratchet<wbr>Public<wbr>Key</a></dt><dd>The public part of a [<code>RatchetKey</code>].</dd><dt><a class="struct" href="struct.Session.html" title="struct vodozemac::olm::Session">Session</a></dt><dd>An Olm session represents one end of an encrypted communication channel
between two participants.</dd><dt><a class="struct" href="struct.SessionConfig.html" title="struct vodozemac::olm::SessionConfig">Session<wbr>Config</a></dt><dd>A struct to configure how Olm sessions should work under the hood.
Currently only the MAC truncation behaviour can be configured.</dd><dt><a class="struct" href="struct.SessionKeys.html" title="struct vodozemac::olm::SessionKeys">Session<wbr>Keys</a></dt><dd>The set of keys that were used to establish the Olm Session,</dd><dt><a class="struct" href="struct.SessionPickle.html" title="struct vodozemac::olm::SessionPickle">Session<wbr>Pickle</a></dt><dd>A format suitable for serialization which implements <a href="https://docs.rs/serde_core/1.0.228/serde_core/ser/trait.Serialize.html" title="trait serde_core::ser::Serialize"><code>serde::Serialize</code></a>
and <a href="https://docs.rs/serde_core/1.0.228/serde_core/de/trait.Deserialize.html" title="trait serde_core::de::Deserialize"><code>serde::Deserialize</code></a>. Obtainable by calling <a href="struct.Session.html#method.pickle" title="method vodozemac::olm::Session::pickle"><code>Session::pickle</code></a>.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.DecryptionError.html" title="enum vodozemac::olm::DecryptionError">Decryption<wbr>Error</a></dt><dd>Error type for Olm-based decryption failures.</dd><dt><a class="enum" href="enum.MessageType.html" title="enum vodozemac::olm::MessageType">Message<wbr>Type</a></dt><dd>An enum over the two supported message types.</dd><dt><a class="enum" href="enum.OlmMessage.html" title="enum vodozemac::olm::OlmMessage">OlmMessage</a></dt><dd>Enum over the different Olm message types.</dd><dt><a class="enum" href="enum.SessionCreationError.html" title="enum vodozemac::olm::SessionCreationError">Session<wbr>Creation<wbr>Error</a></dt><dd>Error describing failure modes when creating a Olm <a href="struct.Session.html" title="struct vodozemac::olm::Session"><code>Session</code></a> from an
incoming Olm message.</dd></dl></section></div></main></body></html>